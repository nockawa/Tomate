<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class ConcurrentBitmapL3All | Tomate </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class ConcurrentBitmapL3All | Tomate ">
      
      <meta name="description" content="Concurrent storage of a BitMap with three levels (two of aggregation) for efficient looking for empty bit.">
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nockawa/Tomate/new/dev/apiSpec/new?filename=Tomate_ConcurrentBitmapL3All.md&amp;value=---%0Auid%3A%20Tomate.ConcurrentBitmapL3All%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/tomate.svg" alt="Tomate">
            Tomate
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="Tomate.ConcurrentBitmapL3All">



  <h1 id="Tomate_ConcurrentBitmapL3All" data-uid="Tomate.ConcurrentBitmapL3All" class="text-break">
Class ConcurrentBitmapL3All  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L32"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="Tomate.html">Tomate</a></dd></dl>
  <dl><dt>Assembly</dt><dd>Tomate.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Concurrent storage of a BitMap with three levels (two of aggregation) for efficient looking for empty bit.</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">[PublicAPI]
public class ConcurrentBitmapL3All</code></pre>
  </div>




  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><span class="xref">ConcurrentBitmapL3All</span></div>
    </dd>
  </dl>



  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>

  <dl class="typelist extensionMethods">
    <dt>Extension Methods</dt>
    <dd>
  <div>
      <a class="xref" href="Tomate.DisposeExtensions.html#Tomate_DisposeExtensions_DisposeAndNull__1_System_Object___0__">DisposeExtensions.DisposeAndNull&lt;T&gt;(object, ref T)</a>
  </div>
  </dd></dl>



  <h2 id="Tomate_ConcurrentBitmapL3All_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>Thread Safety: safe, designed for concurrent use.</p>
<p>
Usage:
Typically designed to implement an occupancy map.
You have a Memory Block that can store x elements and you want to reserve/free these elements in a concurrent fashion.
The occupancy map has one bit per element and when you want to allocate an element, you look for a free bit (with <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_FindNextUnsetL0_System_Int32__System_Int64__">FindNextUnsetL0(ref int, ref long)</a>) and reserve
this bit with <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_SetL0_System_Int32_">SetL0(int)</a>. You can also look for and set 64bits at a time (<a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_FindNextUnsetL1_System_Int32__System_Int64__">FindNextUnsetL1(ref int, ref long)</a> and <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_SetL1_System_Int32_">SetL1(int)</a>).
This class is designed for multiple thread concurrently looking for any available bit (corresponding entry set to 0) to set.
A thread will call <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_FindNextUnsetL0_System_Int32__System_Int64__">FindNextUnsetL0(ref int, ref long)</a> to get the position of a bit actually free, and will call <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_SetL0_System_Int32_">SetL0(int)</a> to reserve it and set it
to one. If another thread beats us and set this bit to one before us, then <a class="xref" href="Tomate.ConcurrentBitmapL3All.html#Tomate_ConcurrentBitmapL3All_SetL0_System_Int32_">SetL0(int)</a> will return <code>false</code> and we have to look for another bit.
</p>
<p>
Implementation:
As the BitMap may hold thousands of bits, looking for free ones, bit by bit, may take too much time as the occupancy rate increases. To alleviate this,
we have two levels of aggregation that allow us to skips complete 64bits blocks (level 1) and compete 64^2 blocks (level 2) during our search.
e.g. the first bit of the L1ALL map is set to 1 is all bit from [0-63] are set to 1.
Finding an unset bit is concurrent friendly, many threads can execute such operation at the same time, but setting or clearing a bit has to be an exclusive
operation (because of resize), but it's fast so if another thread has started such operation (<code>TakeControl()</code> is called), then we SpinWait until
it can be our turn.
</p>
</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="Tomate_ConcurrentBitmapL3All__ctor_" data-uid="Tomate.ConcurrentBitmapL3All.#ctor*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All__ctor_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.#ctor(System.Int32)">
  ConcurrentBitmapL3All(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L373"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Construct an instance</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ConcurrentBitmapL3All(int bitCount)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>bitCount</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>Number of bits to host</p>
</dd>
  </dl>












  <h2 class="section" id="properties">Properties
</h2>


  <a id="Tomate_ConcurrentBitmapL3All_Capacity_" data-uid="Tomate.ConcurrentBitmapL3All.Capacity*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_Capacity" data-uid="Tomate.ConcurrentBitmapL3All.Capacity">
  Capacity
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L50"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int Capacity { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_ConcurrentBitmapL3All_IsFull_" data-uid="Tomate.ConcurrentBitmapL3All.IsFull*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_IsFull" data-uid="Tomate.ConcurrentBitmapL3All.IsFull">
  IsFull
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L48"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool IsFull { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_ConcurrentBitmapL3All_TotalBitSet_" data-uid="Tomate.ConcurrentBitmapL3All.TotalBitSet*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_TotalBitSet" data-uid="Tomate.ConcurrentBitmapL3All.TotalBitSet">
  TotalBitSet
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L51"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int TotalBitSet { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <h2 class="section" id="methods">Methods
</h2>


  <a id="Tomate_ConcurrentBitmapL3All_ClearL0_" data-uid="Tomate.ConcurrentBitmapL3All.ClearL0*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_ClearL0_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.ClearL0(System.Int32)">
  ClearL0(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L57"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void ClearL0(int index)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>index</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>












  <a id="Tomate_ConcurrentBitmapL3All_FindNextUnsetL0_" data-uid="Tomate.ConcurrentBitmapL3All.FindNextUnsetL0*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_FindNextUnsetL0_System_Int32__System_Int64__" data-uid="Tomate.ConcurrentBitmapL3All.FindNextUnsetL0(System.Int32@,System.Int64@)">
  FindNextUnsetL0(ref int, ref long)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L93"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool FindNextUnsetL0(ref int index, ref long mask)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>index</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
    <dt><code>mask</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int64">long</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>











  <a id="Tomate_ConcurrentBitmapL3All_FindNextUnsetL1_" data-uid="Tomate.ConcurrentBitmapL3All.FindNextUnsetL1*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_FindNextUnsetL1_System_Int32__System_Int64__" data-uid="Tomate.ConcurrentBitmapL3All.FindNextUnsetL1(System.Int32@,System.Int64@)">
  FindNextUnsetL1(ref int, ref long)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L160"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool FindNextUnsetL1(ref int index, ref long mask)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>index</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
    <dt><code>mask</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int64">long</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>











  <a id="Tomate_ConcurrentBitmapL3All_IsSet_" data-uid="Tomate.ConcurrentBitmapL3All.IsSet*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_IsSet_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.IsSet(System.Int32)">
  IsSet(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L212"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool IsSet(int index)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>index</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>











  <a id="Tomate_ConcurrentBitmapL3All_Resize_" data-uid="Tomate.ConcurrentBitmapL3All.Resize*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_Resize_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.Resize(System.Int32)">
  Resize(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L221"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void Resize(int newBitCount)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>newBitCount</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>












  <a id="Tomate_ConcurrentBitmapL3All_SetL0_" data-uid="Tomate.ConcurrentBitmapL3All.SetL0*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_SetL0_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.SetL0(System.Int32)">
  SetL0(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L268"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool SetL0(int bitIndex)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>bitIndex</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>











  <a id="Tomate_ConcurrentBitmapL3All_SetL1_" data-uid="Tomate.ConcurrentBitmapL3All.SetL1*"></a>

  <h3 id="Tomate_ConcurrentBitmapL3All_SetL1_System_Int32_" data-uid="Tomate.ConcurrentBitmapL3All.SetL1(System.Int32)">
  SetL1(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L312"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool SetL1(int index)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>index</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>












</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Bitmaps/ConcurrentBitmapL3All.cs/#L32" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright (c) Loïc Baumann
        </div>
      </div>
    </footer>
  </body>
</html>
