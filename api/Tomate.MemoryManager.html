<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Class MemoryManager | Tomate </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Class MemoryManager | Tomate ">
      
      <meta name="description" content="Allow to allocate segments of memory">
      <link rel="icon" href="../images/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/nockawa/Tomate/new/dev/apiSpec/new?filename=Tomate_MemoryManager.md&amp;value=---%0Auid%3A%20Tomate.MemoryManager%0Asummary%3A%20&#39;*You%20can%20override%20summary%20for%20the%20API%20here%20using%20*MARKDOWN*%20syntax&#39;%0A---%0A%0A*Please%20type%20below%20more%20information%20about%20this%20API%3A*%0A%0A">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="ManagedReference">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../images/tomate.svg" alt="Tomate">
            Tomate
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled="" placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="Tomate.MemoryManager">



  <h1 id="Tomate_MemoryManager" data-uid="Tomate.MemoryManager" class="text-break">
Class MemoryManager  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L39"><i class="bi bi-code-slash"></i></a>
  </h1>

  <div class="facts text-secondary">
    <dl><dt>Namespace</dt><dd><a class="xref" href="Tomate.html">Tomate</a></dd></dl>
  <dl><dt>Assembly</dt><dd>Tomate.dll</dd></dl>
  </div>

  <div class="markdown summary"><p>Allow to allocate segments of memory</p>
</div>
  <div class="markdown conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">[Obsolete(&quot;Use DefaultMemoryManager instead&quot;)]
[PublicAPI]
public class MemoryManager : IMemoryManager, IDisposable</code></pre>
  </div>




  <dl class="typelist inheritance">
    <dt>Inheritance</dt>
    <dd>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object">object</a></div>
      <div><span class="xref">MemoryManager</span></div>
    </dd>
  </dl>

  <dl class="typelist implements">
    <dt>Implements</dt>
    <dd>
      <div><a class="xref" href="Tomate.IMemoryManager.html">IMemoryManager</a></div>
      <div><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.idisposable">IDisposable</a></div>
    </dd>
  </dl>


  <dl class="typelist inheritedMembers">
    <dt>Inherited Members</dt>
    <dd>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object)">object.Equals(object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.equals#system-object-equals(system-object-system-object)">object.Equals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gethashcode">object.GetHashCode()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.gettype">object.GetType()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.memberwiseclone">object.MemberwiseClone()</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.referenceequals">object.ReferenceEquals(object, object)</a>
    </div>
    <div>
      <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.object.tostring">object.ToString()</a>
    </div>
  </dd></dl>

  <dl class="typelist extensionMethods">
    <dt>Extension Methods</dt>
    <dd>
  <div>
      <a class="xref" href="Tomate.DisposeExtensions.html#Tomate_DisposeExtensions_DisposeAndNull__1_System_Object___0__">DisposeExtensions.DisposeAndNull&lt;T&gt;(object, ref T)</a>
  </div>
  </dd></dl>



  <h2 id="Tomate_MemoryManager_remarks">Remarks</h2>
  <div class="markdown level0 remarks"><p>Thread safety: SINGLE-THREAD
Common practice is to store instances of it in a <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.threading.threadlocal-1">ThreadLocal&lt;T&gt;</a>.
</p>
<p>
Usage:
The memory manager is designed to allocate big segments of memory that are part of bigger segments (called PinedMemoryBlock (PMB)).
The Memory Manager makes one .net memory allocation per PMB, the block is pinned: it has a fixed address and won't be considered for GC collection,
and will be stored in the dedicated GC area for pinned objects (POH).
At construction the user specifies the size of each PMB, which typically falls in the range of tens/hundreds of megabytes.
Then segments are allocated calling <a class="xref" href="Tomate.MemoryManager.html#Tomate_MemoryManager_Allocate_System_Int32_">Allocate(int)</a>, each segment can't be bigger than the PMB.
Each segment has a fixed memory address and is aligned on a cache line (64 bytes).
A segment is supposed to be allocated to host a group of objects, doing one segment-one object is to avoid and is far from optimal. (see implementation)
Call <a class="xref" href="Tomate.MemoryManager.html#Tomate_MemoryManager_Free_Tomate_MemoryBlock_">Free(MemoryBlock)</a> to release a given segment.
To release the memory allocated by an instance, either call <a class="xref" href="Tomate.MemoryManager.html#Tomate_MemoryManager_Clear">Clear()</a> or <a class="xref" href="Tomate.MemoryManager.html#Tomate_MemoryManager_Dispose">Dispose()</a> or to wait for the instance to be collected.
</p>
<p>
Implementation:
This class is certainly the one that uses the most reference instances, but it's fine, because its usage is typically a very low frequency, well should even be punctual.
There is a <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.list-1">List&lt;T&gt;</a> that references all PMB. Each PMB has its own <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.collections.generic.list-1">List&lt;T&gt;</a> that stores one segment per entry.
Segments are identified by their address, the PMB list and block lists are keep their entry sorted by address to allow binary search.
</p>
</div>


  <h2 class="section" id="constructors">Constructors
</h2>


  <a id="Tomate_MemoryManager__ctor_" data-uid="Tomate.MemoryManager.#ctor*"></a>

  <h3 id="Tomate_MemoryManager__ctor_System_Int32_" data-uid="Tomate.MemoryManager.#ctor(System.Int32)">
  MemoryManager(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L75"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Construct an instance of the memory manager</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MemoryManager(int pinnedMemoryBlockSize)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>pinnedMemoryBlockSize</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>The size to allocate for each Pinned Memory Block</p>
</dd>
  </dl>








  <h4 class="section" id="Tomate_MemoryManager__ctor_System_Int32__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>A Pinned Memory Block should be big, you should think of it as the third level of storage.
Level 1 being the object, which is typically grouped in Memory Segments, the level 2.
You wont be able to allocate a Memory Segment bigger than a Pinned Memory Block.</p>
</div>




  <h2 class="section" id="properties">Properties
</h2>


  <a id="Tomate_MemoryManager_AllocationPinnedMemoryBlockEpoch_" data-uid="Tomate.MemoryManager.AllocationPinnedMemoryBlockEpoch*"></a>

  <h3 id="Tomate_MemoryManager_AllocationPinnedMemoryBlockEpoch" data-uid="Tomate.MemoryManager.AllocationPinnedMemoryBlockEpoch">
  AllocationPinnedMemoryBlockEpoch
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L47"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Will be incremented every time a new Pinned Memory Block is allocated</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int AllocationPinnedMemoryBlockEpoch { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_IsDisposed_" data-uid="Tomate.MemoryManager.IsDisposed*"></a>

  <h3 id="Tomate_MemoryManager_IsDisposed" data-uid="Tomate.MemoryManager.IsDisposed">
  IsDisposed
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L100"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Check if the instance is disposed or not.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool IsDisposed { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_MaxAllocationLength_" data-uid="Tomate.MemoryManager.MaxAllocationLength*"></a>

  <h3 id="Tomate_MemoryManager_MaxAllocationLength" data-uid="Tomate.MemoryManager.MaxAllocationLength">
  MaxAllocationLength
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L53"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int MaxAllocationLength { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_MemoryBlockContentCleanup_" data-uid="Tomate.MemoryManager.MemoryBlockContentCleanup*"></a>

  <h3 id="Tomate_MemoryManager_MemoryBlockContentCleanup" data-uid="Tomate.MemoryManager.MemoryBlockContentCleanup">
  MemoryBlockContentCleanup
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L59"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>This property only works in DEBUGALLOC mode, it is primarily used to change the content of a memory block being freed,
for debugging/troubleshooting purposes.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public DefaultMemoryManager.DebugMemoryInit MemoryBlockContentCleanup { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.DefaultMemoryManager.html">DefaultMemoryManager</a>.<a class="xref" href="Tomate.DefaultMemoryManager.DebugMemoryInit.html">DebugMemoryInit</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_MemoryBlockContentInitialization_" data-uid="Tomate.MemoryManager.MemoryBlockContentInitialization*"></a>

  <h3 id="Tomate_MemoryManager_MemoryBlockContentInitialization" data-uid="Tomate.MemoryManager.MemoryBlockContentInitialization">
  MemoryBlockContentInitialization
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L58"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>This property only works in DEBUGALLOC mode, it is primarily used to initialize the content of newly allocated block,
for debugging/troubleshooting purposes.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public DefaultMemoryManager.DebugMemoryInit MemoryBlockContentInitialization { get; set; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.DefaultMemoryManager.html">DefaultMemoryManager</a>.<a class="xref" href="Tomate.DefaultMemoryManager.DebugMemoryInit.html">DebugMemoryInit</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_MemoryManagerId_" data-uid="Tomate.MemoryManager.MemoryManagerId*"></a>

  <h3 id="Tomate_MemoryManager_MemoryManagerId" data-uid="Tomate.MemoryManager.MemoryManagerId">
  MemoryManagerId
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L54"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int MemoryManagerId { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_MemorySegmentAllocationEpoch_" data-uid="Tomate.MemoryManager.MemorySegmentAllocationEpoch*"></a>

  <h3 id="Tomate_MemoryManager_MemorySegmentAllocationEpoch" data-uid="Tomate.MemoryManager.MemorySegmentAllocationEpoch">
  MemorySegmentAllocationEpoch
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L52"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Will be incremented every time a new memory segment is allocated</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public int MemorySegmentAllocationEpoch { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>








  <a id="Tomate_MemoryManager_Store_" data-uid="Tomate.MemoryManager.Store*"></a>

  <h3 id="Tomate_MemoryManager_Store" data-uid="Tomate.MemoryManager.Store">
  Store
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L56"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public ref UnmanagedDataStore Store { get; }</code></pre>
  </div>





  <h4 class="section">Property Value</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.UnmanagedDataStore.html">UnmanagedDataStore</a></dt>
    <dd></dd>
  </dl>








  <h2 class="section" id="methods">Methods
</h2>


  <a id="Tomate_MemoryManager_Allocate_" data-uid="Tomate.MemoryManager.Allocate*"></a>

  <h3 id="Tomate_MemoryManager_Allocate_System_Int32_" data-uid="Tomate.MemoryManager.Allocate(System.Int32)">
  Allocate(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L182"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Allocate a Memory Segment</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MemoryBlock Allocate(int length)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>length</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>Length of the segment to allocate.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.MemoryBlock.html">MemoryBlock</a></dt>
    <dd><p>The segment or an exception will be fired if we couldn't allocate one.</p>
</dd>
  </dl>







  <h4 class="section" id="Tomate_MemoryManager_Allocate_System_Int32__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The segment's address will always be aligned on 64 bytes, its size will also be padded on 64 bytes.
The segment's address is fixed, you can store it with the lifetime that suits you, it doesn't matter as the segment is part of a
Pinned Memory Block that is a pinned allocation (using <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.gc.allocateuninitializedarray">AllocateUninitializedArray&lt;T&gt;(int, bool)</a> with pinned set to true).</p>
</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.objectdisposedexception">ObjectDisposedException</a></dt>
    <dd><p>Can't allocate because the object is disposed.</p>
</dd>
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.outofmemoryexception">OutOfMemoryException</a></dt>
    <dd><p>The requested size is too big.</p>
</dd>
  </dl>



  <a id="Tomate_MemoryManager_AllocateScoped_" data-uid="Tomate.MemoryManager.AllocateScoped*"></a>

  <h3 id="Tomate_MemoryManager_AllocateScoped_System_Int32_" data-uid="Tomate.MemoryManager.AllocateScoped(System.Int32)">
  AllocateScoped(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L161"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MemoryManager.ScopedMemorySegment AllocateScoped(int size)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>size</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.MemoryManager.html">MemoryManager</a>.<a class="xref" href="Tomate.MemoryManager.ScopedMemorySegment.html">ScopedMemorySegment</a></dt>
    <dd></dd>
  </dl>











  <a id="Tomate_MemoryManager_Allocate_" data-uid="Tomate.MemoryManager.Allocate*"></a>

  <h3 id="Tomate_MemoryManager_Allocate__1_System_Int32_" data-uid="Tomate.MemoryManager.Allocate``1(System.Int32)">
  Allocate&lt;T&gt;(int)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L239"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Allocate a Memory Segment</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public MemoryBlock&lt;T&gt; Allocate&lt;T&gt;(int length) where T : unmanaged</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>length</code> <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.int32">int</a></dt>
    <dd><p>Length (in {T}) of the segment to allocate.</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="Tomate.MemoryBlock-1.html">MemoryBlock</a>&lt;T&gt;</dt>
    <dd><p>The segment or an exception will be fired if we couldn't allocate one.</p>
</dd>
  </dl>

  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd><p>The type of each item of the segment.</p>
</dd>
  </dl>






  <h4 class="section" id="Tomate_MemoryManager_Allocate__1_System_Int32__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>The segment's address will always be aligned on 64 bytes, its size will also be padded on 64 bytes.
The segment's address is fixed, you can store it with the lifetime that suits you, it doesn't matter as the segment is part of a
Pinned Memory Block that is a pinned allocation (using <a class="xref" href="https://learn.microsoft.com/dotnet/api/system.gc.allocateuninitializedarray">AllocateUninitializedArray&lt;T&gt;(int, bool)</a> with pinned set to true).</p>
</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.objectdisposedexception">ObjectDisposedException</a></dt>
    <dd><p>Can't allocate because the object is disposed.</p>
</dd>
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.outofmemoryexception">OutOfMemoryException</a></dt>
    <dd><p>The requested size is too big.</p>
</dd>
  </dl>



  <a id="Tomate_MemoryManager_Clear_" data-uid="Tomate.MemoryManager.Clear*"></a>

  <h3 id="Tomate_MemoryManager_Clear" data-uid="Tomate.MemoryManager.Clear">
  Clear()
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L282"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Release all the allocated segments, free the memory allocated through .net.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void Clear()</code></pre>
  </div>













  <a id="Tomate_MemoryManager_Dispose_" data-uid="Tomate.MemoryManager.Dispose*"></a>

  <h3 id="Tomate_MemoryManager_Dispose" data-uid="Tomate.MemoryManager.Dispose">
  Dispose()
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L105"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Dispose the instance, free the allocated memory.</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public void Dispose()</code></pre>
  </div>













  <a id="Tomate_MemoryManager_Finalize_" data-uid="Tomate.MemoryManager.Finalize*"></a>

  <h3 id="Tomate_MemoryManager_Finalize" data-uid="Tomate.MemoryManager.Finalize">
  ~MemoryManager()
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L90"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">protected ~MemoryManager()</code></pre>
  </div>













  <a id="Tomate_MemoryManager_Free_" data-uid="Tomate.MemoryManager.Free*"></a>

  <h3 id="Tomate_MemoryManager_Free_Tomate_MemoryBlock_" data-uid="Tomate.MemoryManager.Free(Tomate.MemoryBlock)">
  Free(MemoryBlock)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L255"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"><p>Free a previously allocated segment</p>
</div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool Free(MemoryBlock block)</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>block</code> <a class="xref" href="Tomate.MemoryBlock.html">MemoryBlock</a></dt>
    <dd><p>The memory block to free</p>
</dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd><p><code>true</code> if the segment was successfully released, <code>false</code> otherwise.</p>
</dd>
  </dl>







  <h4 class="section" id="Tomate_MemoryManager_Free_Tomate_MemoryBlock__remarks">Remarks</h4>
  <div class="markdown level1 remarks"><p>This method won't prevent you against multiple free attempts on the same segment. If no other segment has been allocated with the same address, then it will return <code>false</code>.
But if you allocated another segment which turns out to have the same address and call <a class="xref" href="Tomate.MemoryManager.html#Tomate_MemoryManager_Free_Tomate_MemoryBlock_">Free(MemoryBlock)</a> a second time, then it will free the second segment successfully.</p>
</div>

  <h4 class="section">Exceptions</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.objectdisposedexception">ObjectDisposedException</a></dt>
    <dd><p>Can't free if the instance is disposed, all segments have been released anyway.</p>
</dd>
  </dl>



  <a id="Tomate_MemoryManager_Free_" data-uid="Tomate.MemoryManager.Free*"></a>

  <h3 id="Tomate_MemoryManager_Free__1_Tomate_MemoryBlock___0__" data-uid="Tomate.MemoryManager.Free``1(Tomate.MemoryBlock{``0})">
  Free&lt;T&gt;(MemoryBlock&lt;T&gt;)
  <a class="header-action link-secondary" title="View source" href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L277"><i class="bi bi-code-slash"></i></a>
  </h3>

  <div class="markdown level1 summary"></div>
  <div class="markdown level1 conceptual"></div>

  <div class="codewrapper">
    <pre><code class="lang-csharp hljs">public bool Free&lt;T&gt;(MemoryBlock&lt;T&gt; memoryBlock) where T : unmanaged</code></pre>
  </div>

  <h4 class="section">Parameters</h4>
  <dl class="parameters">
    <dt><code>memoryBlock</code> <a class="xref" href="Tomate.MemoryBlock-1.html">MemoryBlock</a>&lt;T&gt;</dt>
    <dd></dd>
  </dl>

  <h4 class="section">Returns</h4>
  <dl class="parameters">
    <dt><a class="xref" href="https://learn.microsoft.com/dotnet/api/system.boolean">bool</a></dt>
    <dd></dd>
  </dl>

  <h4 class="section">Type Parameters</h4>
  <dl class="parameters">
    <dt><code>T</code></dt>
    <dd></dd>
  </dl>











</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/nockawa/Tomate/blob/dev/src/Tomate/Memory/MemoryManager.cs/#L39" class="edit-link">Edit this page</a>
        </div>


      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright (c) Loïc Baumann
        </div>
      </div>
    </footer>
  </body>
</html>
